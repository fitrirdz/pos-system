datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id           String        @id @default(uuid())
  username     String        @unique
  password     String
  role         UserRole      @default(ADMIN)
  transactions Transaction[] @relation("UserTransactions")
}

enum UserRole {
  ADMIN
  CASHIER
}

model Category {
  id       String    @id @default(uuid())
  name     String    @unique
  products Product[]
}

model Product {
  id         String   @id @default(uuid())
  code       String   @unique
  name       String
  price      Int
  stock      Int
  categoryId String?
  category   Category? @relation(fields: [categoryId], references: [id])

  items TransactionItem[]
}

model Transaction {
  id            String           @id @default(uuid())
  type          TransactionType @default(SALE)
  subtotal      Int
  discountTotal Int
  tax           Int
  total         Int
  paymentMethod PaymentMethod?
  paidAmount    Int?
  changeGiven   Int              @default(0)
  userId        String
  cashier       User             @relation("UserTransactions", fields: [userId], references: [id])
  createdAt     DateTime         @default(now())

  items TransactionItem[]
}

model TransactionItem {
  id            String   @id @default(uuid())
  transactionId String
  productId     String
  qty           Int
  price         Int

  transaction Transaction @relation(fields: [transactionId], references: [id])
  product     Product     @relation(fields: [productId], references: [id])
}

model Setting {
  id      Int @id @default(1)
  taxRate Int 
}

model Discount {
  id          String @id @default(uuid())
  productCode String
  percentage  Int 
}

enum TransactionType {
  SALE
  STOCK_IN
}

enum PaymentMethod {
  CASH
  DEBIT_CARD
  CREDIT_CARD
  QRIS
  E_WALLET
}

